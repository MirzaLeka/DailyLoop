<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>My Todo App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <!-- Bootstrap CSS script -->
  <link rel="stylesheet" href="../Resources/scripts/bootstrap.css">
  <!-- jQuery script -->
  <script src="../Resources/scripts/jquery.js"></script>
  <!-- Bootstrap JS script -->
  <script src="../Resources/scripts/bootstrap.js"></script>
  <!-- Font Awesome script -->
  <script src="../Resources/scripts/fontawesome.js"></script>


  <!-- Styles-->
  <link rel="stylesheet" type="text/css" href="../Resources/css/navbar.css"/>

  
</head>
<body>

  



      <br>       <br>       <br> 

        <!-- Navbar-->

  <div class="nav">

<div class="container bg-3">
  <div class="row">
    <div class="col-xs-12">


      <div id="formWrapper">
          <input class="searchTodosForm text" autofocus placeholder="Search Todos" type="text"/> 
          <button class="searchTodosBtn" onclick="search()"><i class="fa fa-search" aria-hidden="true"></i></button>
      </div>

      <!-- <h2 style="width: 100%; margin: 0 auto; color: #FFF; text-align: center;">My Todo App</h2> -->

      <ul class="navbarUl">


          <!-- Display documents -->
        
          <li class="navbarLi" id="displayLi">Display &#9660
            <ul class="innerUl" id="displayUl">

          
            </ul>
          
          </li>

            <!-- Sort documents -->

    <li class="navbarLi" id="sortLi">Sort &#9660
    <ul class="innerUl" id="sortUl">
      <label class="radio">
      <input class="sortRadio" name="sort" type="radio" checked>
      <span style="font-weight: 100; text-align: center;">Date created</span>
    </label>
    <label class="radio labelCompleted">
      <input class="sortRadio sortCompleted" name="sort" type="radio">
      <span style="font-weight: 100; text-align: center;">Date completed <span style="color: gold">&#x21E7;</span></span>
    </label>
    <label class="radio labelCompleted">
      <input class="sortRadio sortCompleted" name="sort" type="radio">
      <span style="font-weight: 100; text-align: center;">Date completed <span style="color: gold">&#x21E9;</span></span>
    </label>
    <label class="radio">
        <input class="sortRadio" name="sort" type="radio">
        <span style="font-weight: 100; text-align: center;">Last updated</span>
      </label>
      
    </ul>
    
  </li>


    <!-- Limit results -->

    <li class="navbarLi" id="limitLi">Limit &#9660
      <ul class="innerUl" id="limitUl">
  
      </ul>
    
    </li>

  </div>

</div>
</div>


      </ul>
  </div>
  
  <!-- / Navbar-->

      <br>       <br>       <br>


    <div class="container-fluid bg-3" style="color: white;">
      <div id="showList" class="row">



      </div>
    </div>

    <br> <br>


    <select id="selectTag"> 
        
        
      </select>
      
      <button class="btn btn-success" onclick="getSelected()">Get Value of Selected</button>
      
      <button class="btn btn-primary" onclick="patch()">PATCH</button>

    <script>

  


      function getSelected() {

        var select = $('select').find(":selected").attr("value"); // .find(":selected").text() would return text of selected
      alert(select);

      // you will post value of selected to DB
      // once get request starts, you'll pull that value through API

      // example: data.todos[i].nesto <img src="arrayOfImages[selectedValue]" SOMETHING LIKE THIS :)

}





  //    let align = "";
      let limit = "No limit";
      let theme = "";
      let display = "Display all";
      let sort = 'Date created';

      $(document).ready(() => {

        getAllTodos();

        options();
        limiting();
        sorting();
        displaying();
    

        
        // Fake GET request

        // if (4 < 5) {
        //   $(".optionTag:eq(5)").attr('selected', true); // DIsplay SELECTED OPTION once you pull data from DB
        // }

      

        // Fake GET request -- CHANGE SELECTED VALUE

        // if (2 < 5) {
        //   $(".alignRadio:eq(0)").attr('checked', true); // give 0th or whichever element attribute selected once it comes from DB
        // }

        

      });


      function getAllTodos() {

        let align =  $(".alignRadio:checked").parent(".radio").text(); 
        align = align.trim(); 

        $.ajax({
          type: "GET",
          url: `/todos/${align}`,
          success: function(data) {

                      var li = '';
          
          for (var i = 0; i < data.todos.length; i++) {

            let theme = data.todos[i].theme;

            // CHECK NXC PAGE LOADER AND CHANGE CSS
            // BEFORE THE PAGE CONTENT LOADS
            // JUST LIKE WITH LOADING

            // FIX THIS WITH COUNTER
            // PUT THIS INTO FUNCTION RATHER THAN COPY PASTE MULTIPLE TIMES
            // MAKE SURE THIS EXECUTES AS CSS RATHER THAN AFTER SCRIPT IS CALLED AND AJAX IS COMPLETE
            // CREATE AN OBJECT, LIKE THE ONE FROM OBJECT FILE

        if (theme == "Cobalt") {
        $("body").css("background", "#09223f");
        $(".themeRadio:eq(1)").attr('checked', true);
      } else if (theme == "Red tiger") {
        $("body").css("background", "#111");
        $(".themeRadio:eq(5)").attr('checked', true);
      } else if (theme == "Snowball") {
        $("body").css("background", "#FFF");
        $(".themeRadio:eq(3)").attr('checked', true);
      } else if (theme == "Dirt") {
        $("body").css("background", "#f7bb7b");
        $(".themeRadio:eq(4)").attr('checked', true);
      } else if(theme == "Matrix") {
        $("body").css("background", "#2cbe2b");
        $(".themeRadio:eq(2)").attr('checked', true);
      } else {
        $("body").css("background", "#343e4a"); // Default body background
        $(".themeRadio:eq(0)").attr('checked', true);
      }

        if (data.todos[i].align == "List") {

      $(".alignRadio:eq(0)").attr('checked', true);

          li+= `<li>Text: ${data.todos[i].text}, Completed: ${data.todos[i].completed}</li>`;
        }
         else {

  $(".alignRadio:eq(1)").attr('checked', true);

           li+=`
           <div class="col-sm-4">
    
            <div class="grid" style="border: 2px solid white; color: #FFF; height: 350px; position: relative;">
              
                <img src="../Resources/img/tags/drive.jpg" class="img-responsive" style="width:100%; height: 250px;" alt="Image">

                
    <div class="col-xs-12" >  
      
      <h3 style="color: white">${data.todos[i].text}</h3>
      
      </div>



      <div>
        
        <div class="col-xs-6">${data.todos[i].completed}</div> <div class="col-xs-6">${data.todos[i].completedAt}</div>

        </div>
      
      </div>
              

       <div class="outer" title="Complete Todo" style="position: absolute; top: 10%; right: 5%;">
<div class="switch"></div>
</div>
</div>    
              
              
              </div>      
    
            </div>
           `;
            }

        }

        $("#showList").html(li);

        /* THEMES SECTION 
        
        
        
        */
            
          }
        })


      }












    function search() {

    let text = $("input").val();

    if (text == '') {
      text = ".";
    }

    // let completed =  $('#filterCompleted').find(":selected").text();

 //   let limit = $('#limitResults').find(":selected").text();

// POST previous variables to backend but don't use location.reload() when posting

      $.ajax({
        type: "GET",
        url: `/todos/${text}/${display}/${limit}/${sort}/`,
        success: function (data) {

          console.log(data);
          var li = '';
          
            for (var i = 0; i < data.todos.length; i++) {

       
            li+= `<li>Text: ${data.todos[i].text}, Completed: ${data.todos[i].completed}</li>`;
       
                   }

          $("#showList").html(li);

        }
      });


    }



function patch() {

  
      let align =  $(".alignRadio:checked").parent(".radio").text(); 
      align = align.trim(); 

      let theme =  $(".themeRadio:checked").parent(".radio").text(); 
      theme = theme.trim(); 

      
      /* Change Theme */ // TODO THAT RADIO btn like with list/grid

      if (theme == "Cobalt") {
        $("body").css("background", "#09223f");
      } else if (theme == "Red tiger") {
        $("body").css("background", "#111");
      } else if (theme == "Snowball") {
        $("body").css("background", "#FFF");
      } else if (theme == "Dirt") {
        $("body").css("background", "#f7bb7b");
      } else if(theme == "Matrix") {
        $("body").css("background", "#2cbe2b");
      } else {
        $("body").css("background", "#343e4a"); // Default body background
      }

      $.ajax({
        type: "GET",
        url: `/todos/${display}/${limit}/${sort}/`,
        success: function (data) {


          if (data.todos.length == 0) {
            return console.log("No match found");
          }

     //     console.log(data);
          var li = '';
          
            for (var i = 0; i < data.todos.length; i++) {

          if (align == "List") {
            li+= `<li>Text: ${data.todos[i].text}, Completed: ${data.todos[i].completed}</li>`;
          }
           else {
             li+=`
             <div class="col-sm-4">
      
              <div class="grid" style="border: 2px solid white; color: #FFF; height: 350px; position: relative;">
                
                  <img src="../Resources/img/tags/drive.jpg" class="img-responsive" style="width:100%; height: 250px;" alt="Image">

                  
      <div class="col-xs-12" >  
        
        <h3 style="color: white">${data.todos[i].text}</h3>
        
        </div>



        <div>
          
          <div class="col-xs-6">${data.todos[i].completed}</div> <div class="col-xs-6">${data.todos[i].completedAt}</div>

          </div>
        
        </div>
                

         <div class="outer" title="Complete Todo" style="position: absolute; top: 10%; right: 5%;">
 <div class="switch"></div>
 </div>
  </div>    
                
                
                </div>      
      
              </div>
             `;
              }

          }

          $("#showList").html(li);

        }
      });


/////////////////////////

console.log("THeme is " + theme);

var data = {
 "align": align,
 "theme": theme
};


$.ajax({
url: "/todos",
data: JSON.stringify(data),
type: 'PATCH',
contentType: 'application/json',
processData: false,
dataType: 'json',
success: function (data) {
// location.reload();
},
error: function(err) {
  console.log(err);
}


});


}


function options() {

        const options = [
          "- No tag -", "Birthday", "Book", "Clean", "Coffee",
          "Dance", "Date", "Diet", "Dress up", "Drive",
          "Event", "Explore", "Farm", "Food", "Help",
          "Health", "Holiday", "Movie", "Music", "Nap",
          "Pet", "Play", "Pray", "Relax", "Shop",
          "Shower", "Sports", "Travel", "Work", "Wedding",
          "Workout"];

    let addOption = '';
    options.forEach((option, i) => {
      addOption += `<option class="optionTag" value=${i}>${option}</option>`;
    });

    $("#selectTag").append(addOption);

}




function limiting() {

  let text = $("#text").val();

  const limitArray = ["No limit", 1, 3, 5, 10, 15, 20];

    let addLimit = '';
    limitArray.forEach((lim, i) => {
      addLimit += `
    <label class="radio">
    <input class="limitRadio"  name="limit" type="radio">
    <span style="font-weight: 100; text-align: center;">${lim}</span>
    </label>
  `;
    });

  $("#limitUl").append(addLimit);

  $(".limitRadio:eq(0)").attr('checked', true);


      /* Limit search */

      $(".limitRadio").click(function() {

      limit = $(this).parent(".radio").text();
      limit = limit.trim();  

      search();
  });



}


function sorting() {

      /* Sort documents */

      $(".sortRadio").click(function() {

    let text = $("#text").val();

    sort = $(this).parent(".radio").text();
    sort = sort.trim();  

    search();
});


}

function displaying() {

  let text = $("#text").val();

  const displayArray = ["All", "Completed", "Not completed"];

    let addDisplay = '';
    displayArray.forEach((dis, i) => {
    addDisplay += `
    <label class="radio">
              <input class="displayRadio" name="display" type="radio">
              <span style="font-weight: 100; text-align: center;">${dis}</span>
            </label>
    `;
  });

  $("#displayUl").append(addDisplay);

  $(".displayRadio:eq(0)").attr('checked', true);

    
        /* Display documents */

      $(".displayRadio").click(function() {

    display = $(this).parent(".radio").text();
    display = display.trim();  

    if (display == "Not completed") {
      $(".sortCompleted").attr("disabled",true);
      $(`.labelCompleted`).css({ "cursor": "default" });
      $(".labelCompleted").hover(  function () {
        $(this).css("background", "#222");
      });

    } else {
      $(".sortCompleted").attr("disabled",false);
      $(`.labelCompleted`).css({ "cursor": "pointer" });

      $(".labelCompleted").on('mouseenter',  function () {
        $(this).css("background", "#007BFF");
      });

      $(".labelCompleted").on('mouseleave',  function () {
        $(this).css("background", "#222");
      });

    }

    search();

    });

}




  /* Fade in / out navbar inner lists */
   
$(".navbarLi").on('mouseenter', function() {
$(this).find(".innerUl").fadeIn();
});

$(".navbarLi").on('mouseleave', function() {
$(this).find(".innerUl").fadeOut();
});



    
    </script>

</body>

</html>