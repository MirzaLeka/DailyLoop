<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>    
  <!-- Font awesome -->
  <script src="https://use.fontawesome.com/fe459689b4.js"></script>
</head>
<body>

        <!-- <form action="/todos" method="POST" class"form-group">
          <label>Insert Todo</label><br>
          <input type="text" placeholder="e.g. Go to bed" class="form-control"/> <br>
          <input type="submit" class="btn btn-success" value="Submit"/> 
        </form> -->

    <!-- Did you complete it
    <input class="form-control" type="text" id="completed"/> <br>
    When
    <input type="number" id="completedAt"/> <br>
    <br>  <br> -->
    Insert Todo
    <input class="form-control" style="width: 250px" type="text" id="text"/> <br>
    <button class="btn btn-success" onclick="submit()">Submit Todo</button>
    
    <h2 id="id">Todos:</h2> 
    <br>

    <div id="main"></div>

    <!-- <br>
    <br>
    Delete Todo
    <input class="form-control" style="width: 250px" type="text" id="deleteText"/> <br>
    <button class="btn btn-danger" onclick="deleteTodo()">DELETE</button> -->

    <br> <br>
    <!-- Find Todo 
    <input type="text" id="search" placeholder="Type id"/>
    <button class="btn btn-primary" onclick="search()">Search</button>

    <div id="todo"></div> -->

    <button class="btn btn-danger" onclick="deleteAllTodos()">DELETE ALL</button>

    <br> <br>

    Update
    <input class="form-control" style="width: 250px" type="text" id="updateTodo"/> <br>
    <button class="btn btn-success" onclick="updateTodo()">Update Todo</button>
    
</body>
<style>

body{
    margin: 40px;
}

.todoContainer{
    border: 1px solid #111;
}

</style>


<script>

$(document).ready(() => {

$.ajax({
    type: "GET",
    url: "/todos",
    success: function(data) {

console.log(data);  

var list = '';

for (var i = 0; i < data.todos.length; i++) {
list += `<div class="container todoContainer">
     <div class="col-sm-10">
    <h3 class="title">${data.todos[i].text}</h3>
           </div>
   <div class="col-sm-1">
    <button class="btn btn-success" title="Complete" style="border-radius: 100%; margin-top: 12px;" onclick="updateTodo()"><i class="fa fa-pencil" aria-hidden="true"></i></button>
    </div>        
   <div class="col-sm-1">
      <button class="btn btn-danger" title="Remove" style="border-radius: 100%; margin-top: 12px;" onclick="getTitle(${i})">X</button>
            </div>
    </div>`;
}

document.getElementById("main").innerHTML = list;

    }

});

});


    $("#text").keyup(function(event){
  if(event.keyCode == 13){
    submit();
  }
});




    // var complete = false;

function submit() {

    var text = $("#text").val();

    text =  adjustString(text);


//     var completed = $("#completed").val();

// console.log("Completed value is " + completed);

//     var completedAt = $("#completedAt").val();

    // if (completed == ' ') {
    //     complete = true;
    // }  else {
    //     complete == true;
    // }

 //   console.log("Complete is " + complete + ", completedAt is" + completedAt);

var data = {
    "text": text
}

//console.log("DAta is " + JSON.stringify(data));

$.ajax({
    type: "POST",
    url: "/todos",
    contentType : 'application/json',
    dataType : 'json',
    data : JSON.stringify(data),
    success: function(data) {
    
    location.reload(); // reloads page
    }

});


}

function search() {

    console.log("I'm inside");

var search = $("#search").val();

console.log("Value of search is " + search);

$.ajax({
    type: "GET",
    url: "/todos/5b609055aedeae23fcfa9ddd/",
    contentType : 'application/json',
    dataType : 'json',
    sucess: function(data) {
       var myData = JSON.parse(data.responseText);
       
        console.log("succeeded");
        console.log(myData);
    }
});

}

function getTitle(counter) {

    console.log("Counter: " + counter)

// var todoTitle =  $("h2").html();

var todoTitle =  $(`.todoContainer:eq(${counter})`).find(`.title`).html();

// alert(todoTitle);

    $.ajax({
    url: '/todos/' + todoTitle,
    type: 'DELETE',
    success: function(result) {
    location.reload();
    }
});


}

function deleteTodo() {

    var deleteText = $("#deleteText").val();
 //   console.log("1: "+ deleteText);

    deleteText = adjustString(deleteText);

    $.ajax({
    url: '/todos/' + deleteText,
    type: 'DELETE',
    success: function(result) {
     console.log("Deleted: \n" + JSON.stringify(result));
    location.reload();
    }
});
}

function deleteAllTodos() {

    $.ajax({
    url: '/todos',
    type: 'DELETE',
    success: function() {
        location.reload();
    }


});

}


function adjustString(str) {

    str = str.trim();
    // console.log("2: "+ str);
    str = str.toLowerCase();
    // console.log("3: "+ str);
    str = str.charAt(0).toUpperCase() + str.substr(1,str.length).toLowerCase();
    // console.log("4:" + str);

    return str;
}



function updateTodo() {

var updateTodo = $("#updateTodo").val();
//var updateCompleted = $("#updateCompleted").val();

var data = {
    text: updateTodo,
    completed: true
};

$.ajax({
url: "/todos/5b6373e3dad6f310dc087cf0",
data: JSON.stringify(data),
type: 'PATCH',
contentType: 'application/json',
processData: false,
dataType: 'json',
success: function (data) {
location.reload();
}


});

}



</script>

</html>